<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decrypt and Play MP4 Stream</title>
</head>
<body>
<script>
    async function decryptMP4(encryptedData, key) {
        // Ensure that the key length is appropriate for the chosen algorithm
        if (key.length !== 32) {
            console.error('Invalid key length. Expected 32 bytes (256 bits).');
            return null;
        }

        const iv = encryptedData.slice(0, 16);
        const encryptedContent = encryptedData.slice(16);

        try {
            const importedKey = await crypto.subtle.importKey(
                'raw',
                key,
                { name: 'AES-CBC' },
                true,
                ["decrypt", "encrypt"]
            );

            console.log('Imported key:', importedKey);

            const decryptedContent = await crypto.subtle.decrypt(
                { name: 'AES-CBC', iv: iv },
                importedKey,
                new Uint8Array(encryptedContent)
            );

            console.log('Decrypted content:', decryptedContent);

            return decryptedContent;
        } catch (error) {
            console.error('Error during decryption:', error);
            return null;
        }
    }

    function arrayBufferToHex(buffer) {
        return Array.from(new Uint8Array(buffer), byte => byte.toString(16).padStart(2, '0')).join('');
    }

    // Load the encrypted MP4 data (replace 'encrypted_input.mp4' with your file path)
    fetch('encrypted_output.mp4')
        .then(response => response.arrayBuffer())
        .then(async encryptedArrayBuffer => {
            // Your decryption key (replace 'yourDecryptionKey' with your key)
            const decryptionKey = new TextEncoder().encode('12312312312312313212312312312312');

            // Decrypt the MP4 data
            const decryptedArrayBuffer = await decryptMP4(new Uint8Array(encryptedArrayBuffer), decryptionKey);

            if (decryptedArrayBuffer) {
                // Convert the decrypted data to hex (for demonstration purposes)
                const decryptedHex = arrayBufferToHex(decryptedArrayBuffer);

                // Create a Blob from the decrypted data
                const decryptedBlob = new Blob([decryptedArrayBuffer], { type: 'video/mp4' });

                // Create a URL for the Blob
                const decryptedUrl = URL.createObjectURL(decryptedBlob);

                // Create video element
                const video = document.createElement('video');
                video.src = decryptedUrl;
                video.controls = true;

                // Append video element to the body
                document.body.appendChild(video);

                // You can now use the decrypted data as needed
                console.log('Decrypted MP4 data:', decryptedHex);
            } else {
                console.error('Decryption failed.');
            }
        })
        .catch(error => console.error('Error loading or decrypting MP4 data:', error));
</script>
</body>
</html>
