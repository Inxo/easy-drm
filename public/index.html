<!DOCTYPE html>
<html>
<head>
    <title>Расшифровка видео</title>
</head>
<body>
<video id="video" controls></video>

<script>
    async function decryptAndPlayVideo() {
        try {
            const response = await fetch('http://localhost:8080/video');
            const encryptedData = await response.arrayBuffer();

            const key = new TextEncoder().encode("your_secret_aes_key_32_charslong");
            const iv = new Uint8Array(16); // Создаем пустой вектор инициализации

            // Создаем блочный шифр
            const cipher = await window.crypto.subtle.importKey(
                'raw',
                key,
                {name: 'AES-CTR'},
                false,
                ['encrypt', 'decrypt']
            );

            // Расшифровываем данные
            const decryptedData = await window.crypto.subtle.decrypt(
                {
                    name: "AES-CTR",
                    counter: iv,
                    length: 128
                },
                cipher,
                encryptedData
            );

            // Преобразуем расшифрованные данные в Blob
            const decryptedBlob = new Blob([decryptedData], {type: 'video/mp4'});

            // Создаем URL для видео
            const videoUrl = URL.createObjectURL(decryptedBlob);

            // Устанавливаем URL для видео элемента
            const video = document.getElementById('video');
            video.src = videoUrl;
        } catch (error) {
            console.error('Ошибка:', error);
            alert('Не удалось расшифровать и загрузить видео.');
        }
    }

    decryptAndPlayVideo();
</script>
</body>
</html>
